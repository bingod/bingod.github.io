
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>IoVision</title>
<link rel="shortcut icon" href="/static/img/favicon.ico"/>
<link rel="stylesheet" href="/static/style/style.css" type="text/css">
<script src="/static/js/run_prettify.js"></script>
</head>
<body>
<div id="content">
<header id="header_index">
<hgroup>
<h2 class="site-nav"><a href="/">首页</a></h2>
<h2 class="site-nav"><a href="/hobby">爱好</a></h2>
<h2 class="site-nav"><a href="/about">About</a></h2>
</hgroup>
</header>
<div id="main">
<div class="article_wrapper">
<article>
<div class="entry-header">
<h1 class="entry-title">jvm系列之jni</h1>
<div class="entry-meta">
<span class="sep"><time>2014-01-19 16:51 +080</time></a></span>
</div>
</div>
<div class="entry-content">
<p>JNI其实是Java Native Interface的简称,也就是java本地接口。它提供了若干的API实现了和Java和其他语言的通信（主要是C&amp;C++）。也许不少人觉得Java已经足够强大，为什么要需要JNI这种东西呢？我们知道Java是一种平台无关性的语言，平台对于上层的java代码来说是透明的，所以在多数时间我们是不需要JNI的，但是假如你遇到了如下的三种情况之一呢？
你的Java代码中需要用到某种算法，不过算法是用C实现并封装在动态链接库文件（DLL）当中的。
<!-- more -->
<pre class="prettyprint">
package solution;
public class JavaNativeTest {
    static {
        System.loadLibrary("hellodll");
    }
    public native void display();
    public static void main(String[] args) {
        new JavaNativeTest().display();
    }
}
</pre>
编译后在bin目录
javah -jni solution.JavaNativeTest（solution为包名）</p>
<h3>生成扩展名为h的头文件</h3>
<p>会自动产生一个solution_JavaNativeTest.h文件：</p>
<pre><code>/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class solution_JavaNativeTest */

#ifndef _Included_solution_JavaNativeTest
#define _Included_solution_JavaNativeTest
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     solution_JavaNativeTest
 * Method:    display
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_solution_JavaNativeTest_display
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
</code></pre>
<h3>编写本地</h3>
<p>我们自己写一下一个solution_JavaNativeTest.cpp文件</p>
<pre><code>#include &lt;stdio.h&gt;
#include "solution_JavaNativeTest.h"
JNIEXPORT void JNICALL Java_solution_JavaNativeTest_display
  (JNIEnv *, jobject) {
printf("helloworld");
return;}
</code></pre>
<h3>生成动态链接库：</h3>
<p>export JAVA_HOME=/usr/lib/jvm/java-7-openjdk-i386</p>
<p>g++ -I$JAVA_HOME/include -I$JAVA_HOME/include/linux solution_JavaNativeTest.cpp -shared -o libhellodll.so</p>
<p>Eclipse Web项目的Java Build Path里面，JRE Library 属性里的Native Library location指定lib+(动态链接库名称)+.so所在的目录
然后就可以正常运行了。</p>
</div>
</article>
<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'iovision'; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
</div>
<footer class="footer">
<div class="footer_powered_by">
Powered by <a href="http://www.ckecy.com">Bingod</a>
</div>
</footer>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-43860851-1', 'auto');
ga('send', 'pageview');
</script>
</div>
</body>
</html>